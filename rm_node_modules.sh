#!/usr/bin/env sh

#----
# Finds node_modules folders and deletes them.
# On every iteration the maxdepth search is increased to clean up disk space

MAX_DEPTH=2

find_and_remove () {
	FOUND=$(find . -maxdepth $1 -type d -name "node_modules")
	if [ "$FOUND" != "" ] ; then
		echo "$FOUND" | xargs rm -rf
		EXIT=0
	else
		echo "nothing found"
		EXIT=1
	fi
}

while [ $MAX_DEPTH -lt 10 ] ; do
	find_and_remove $MAX_DEPTH
	if [ $EXIT -ne 0 ] ; then
		echo "exiting"
		exit
	fi
	echo "searching with depth $MAX_DEPTH"
	MAX_DEPTH=$(expr $MAX_DEPTH + 1)
done
